<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Transcri√ß√£o + 100 Gatilhos (sem API)</title>
<style>
  :root { --bg1:#0f172a; --bg2:#0b1220; --card:#1e293b; --borda:#334155; --txt:#e5e7eb; --muted:#94a3b8; --ok:#22c55e; --danger:#ef4444; --toast:#111827; }
  *{box-sizing:border-box}
  body{margin:0;background:linear-gradient(180deg,var(--bg1),var(--bg2));color:var(--txt);
       font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;padding:20px;display:flex;flex-direction:column;align-items:center;gap:16px}
  h1{margin:0;font-size:20px}
  .panel{width:92%;max-width:760px;background:var(--card);border:1px solid var(--borda);border-radius:12px;padding:14px 12px}
  .row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
  .buttons{display:flex;gap:10px;flex-wrap:wrap;margin-bottom:10px}
  button{appearance:none;border:0;padding:10px 14px;border-radius:10px;font-weight:700;cursor:pointer}
  .start{background:var(--ok);color:#052e16}
  .stop{background:var(--danger);color:#fff}
  .clear{background:transparent;color:var(--txt);border:1px solid var(--borda)}
  .test{background:#3b82f6;color:#fff}
  .chip{display:inline-flex;gap:6px;align-items:center;font-size:12px;background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.1);padding:6px 10px;border-radius:999px}
  .dot{width:8px;height:8px;border-radius:50%;background:#64748b}
  .dot.on{background:#10b981;box-shadow:0 0 0 4px rgba(16,185,129,.18)}
  label{display:block;font-size:12px;color:var(--muted);margin:6px 0}
  #box{height:260px;background:#0b1020;border:1px dashed var(--borda);border-radius:10px;padding:10px;overflow-y:auto;white-space:pre-wrap;line-height:1.45}
  .controls{display:grid;grid-template-columns:1fr 1fr;gap:10px}
  input[type="number"]{width:100%;padding:10px 12px;border-radius:10px;background:#0b1020;border:1px solid rgba(255,255,255,.12);color:var(--txt)}
  #toasts{position:fixed;right:16px;bottom:16px;display:flex;flex-direction:column;gap:8px;z-index:999999}
  @media (max-width:540px){ #toasts{right:50%;transform:translateX(50%);} }
  .toast{background:#111827;border:1px solid rgba(255,255,255,.12);border-left:5px solid #22c55e;color:#e5e7eb;
         padding:12px 14px;border-radius:10px;max-width:92vw;width:320px;opacity:0;transform:translateY(6px) scale(.98);animation:pop .2s ease-out forwards}
  .toast h4{margin:0 0 4px 0;font-size:14px} .toast p{margin:0;font-size:13px;color:#d1d5db}
  @keyframes pop{to{opacity:1;transform:translateY(0) scale(1)}}
</style>
</head>
<body>
  <h1>üéôÔ∏è Transcri√ß√£o + 100 Gatilhos</h1>

  <div class="panel">
    <div class="row" style="justify-content:space-between">
      <div class="buttons">
        <button class="start" id="btnStart">Iniciar</button>
        <button class="stop" id="btnStop">Parar</button>
        <button class="clear" id="btnClear">Limpar</button>
        <button class="test" id="btnTest">Testar toast</button>
      </div>
      <span class="chip"><span id="dot" class="dot"></span><span id="status">Parado</span></span>
    </div>

    <div class="controls">
      <div>
        <label for="cooldown">Cooldown por palavra (segundos)</label>
        <input id="cooldown" type="number" min="0" step="0.5" value="4" />
      </div>
      <div class="row" style="gap:12px">
        <label style="margin:0"><input type="checkbox" id="partialOn" checked> Disparar tamb√©m em parcial (debounce)</label>
      </div>
    </div>

    <label style="margin-top:6px">Transcri√ß√£o</label>
    <div id="box"></div>

    <label style="margin-top:10px">Exemplos de termos (100 no total, agrupados):</label>
    <div style="font-size:12px;color:var(--muted)">
      Relacionamento (cliente, senhor, fam√≠lia‚Ä¶) ‚Ä¢ Cart√µes (cart√£o, limite, fatura‚Ä¶) ‚Ä¢ Cr√©dito (empr√©stimo, parcelas, juros‚Ä¶) ‚Ä¢ Investimentos (cdb, lci, a√ß√µes‚Ä¶) ‚Ä¢ Seguros (vida, residencial, autom√≥vel‚Ä¶) ‚Ä¢ Empresa (mei, getnet, faturamento‚Ä¶) ‚Ä¢ Digital (app, pix, senha‚Ä¶) ‚Ä¢ Obje√ß√µes (caro, urgente, confian√ßa‚Ä¶) ‚Ä¢ Emo√ß√µes (satisfeito, preocupado‚Ä¶) ‚Ä¢ A√ß√£o (meta, campanha, promo√ß√£o‚Ä¶)
    </div>
  </div>

  <div id="toasts"></div>

<script>
  // ===== Util/UI =====
  const $ = s => document.querySelector(s);
  const box = $("#box"), dot = $("#dot"), statusTxt = $("#status"), toasts = $("#toasts");
  function setStatus(on){ if(on){dot.classList.add("on"); statusTxt.textContent="Gravando";} else {dot.classList.remove("on"); statusTxt.textContent="Parado";} }
  function showToast(title, body){
    const el = document.createElement('div');
    el.className = 'toast';
    el.innerHTML = `<h4>${title}</h4><p>${body}</p>`;
    toasts.appendChild(el);
    setTimeout(()=>{ el.style.opacity=.0; el.style.transform='translateY(6px)'; setTimeout(()=>el.remove(), 300); }, 4500);
  }
  $("#btnTest").onclick = ()=> showToast('‚úÖ Toast OK', 'O componente de notifica√ß√£o est√° funcionando.');

  // ===== Normaliza√ß√£o =====
  const normalize = s => (s||"").toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g,'');
  const tokenize = s => normalize(s).split(/[^a-z0-9]+/).filter(Boolean);

  // ===== 100 gatilhos (agrupados) =====
  // Cada grupo compartilha 1 insight. Palavras cobrem singular/plural e varia√ß√µes comuns.
  const groups = [
    // üë• Relacionamento / Cliente (10)
    { words:['cliente','clientes','senhor','senhora','voce','familia','filho','esposa','aposentado','estudante','empresario'],
      tip:'Comece por necessidade e contexto do cliente antes de oferecer solu√ß√µes.' },

    // üí≥ Cart√µes / Pagamentos (10)
    { words:['cartao','cartoes','credito','debito','limite','fatura','parcelado','anuidade','black','platinum','virtual'],
      tip:'Valide limite, benef√≠cios e isen√ß√£o de anuidade; ofere√ßa op√ß√£o adequada ao perfil.' },

    // üí∞ Cr√©dito / Empr√©stimos (10)
    { words:['emprestimo','consignado','pessoal','financiamento','carro','imovel','parcelas','juros','prazo','renegociacao'],
      tip:'Confirme valor, prazo e parcela confort√°vel; ofere√ßa simula√ß√£o com e sem seguro.' },

    // üìà Investimentos (10)
    { words:['investimento','investir','poupanca','cdb','lci','lca','fundo','previdencia','acoes','bolsa'],
      tip:'Pergunte objetivo, prazo e liquidez; apresente 2-3 op√ß√µes alinhadas ao perfil.' },

    // üõ°Ô∏è Seguros / Prote√ß√£o (10)
    { words:['seguro','vida','residencial','automovel','saude','viagem','protecao','cobertura','indenizacao','risco'],
      tip:'Conecte a prote√ß√£o ao momento de vida e custos imprevistos; mostre cen√°rios simples.' },

    // üìä Neg√≥cios / Empresa (10)
    { words:['empresa','mei','pj','maquininha','getnet','faturamento','boleto','nota','fornecedor','fluxo'],
      tip:'Explore recebimentos, custos e fluxo de caixa; proponha conta PJ e solu√ß√µes Getnet.' },

    // üåê Servi√ßos Digitais (10)
    { words:['app','internet','online','senha','token','pix','qrcode','qr','transferencia','extrato','comprovante'],
      tip:'Oriente o uso do app: seguran√ßa, limites e atalhos (Pix, comprovante, extrato).' },

    // üí° Obje√ß√µes / Necessidades (10)
    { words:['caro','barato','necessidade','urgente','problema','duvida','confianca','confiavel','demora','risco'],
      tip:'Agrade√ßa a obje√ß√£o, valide o motivo e ofere√ßa alternativa com benef√≠cio claro.' },

    // üòÄ Emo√ß√µes / Sensa√ß√µes (10)
    { words:['feliz','satisfeito','insatisfeito','preocupado','tranquilo','seguro','ansioso','confiante','chateado','animado'],
      tip:'Acolha a emo√ß√£o do cliente e ajuste o tom: investigue antes de orientar.' },

    // üöÄ A√ß√£o / Oportunidade (10)
    { words:['oportunidade','meta','resultado','bonus','desconto','campanha','promocao','beneficio','vantagem','prioridade'],
      tip:'Crie pr√≥ximo passo concreto: proposta, simula√ß√£o ou agendamento com prazo.' }
  ];
  // Garante ~100 palavras (alguns grupos t√™m 11 pelo ‚Äúqrcode/qr‚Äù)

  // Monta um mapa palavra‚Üítip para lookup r√°pido
  const wordToTip = new Map();
  groups.forEach(g => g.words.forEach(w => wordToTip.set(w, g.tip)));

  // ===== Disparo (final e parcial) com cooldown por palavra =====
  const lastByWord = new Map();
  const COALESCE_MS = 650; // debounce parcial
  let partialTimer = null;

  function runTriggers(text){
    const cdMs = Math.max(0, Number($("#cooldown").value||4)*1000);
    const now = Date.now();
    const tokens = tokenize(text);
    if(tokens.length === 0) return;

    // Dispara apenas 1 por trecho, priorizando ordem dos grupos
    for(const g of groups){
      for(const w of g.words){
        if(tokens.includes(w)){
          const last = lastByWord.get(w) || 0;
          if(now - last > cdMs){
            showToast('üí° Insight', wordToTip.get(w));
            lastByWord.set(w, now);
          }
          return;
        }
      }
    }
  }

  // ===== Transcri√ß√£o (Web Speech API) =====
  const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
  let recognition = null, listening = false;

  function setupRec(){
    if(!SR){
      box.textContent = "Web Speech API n√£o suportada (use Chrome desktop/Android).";
      return null;
    }
    const rec = new SR();
    rec.lang = 'pt-BR';
    rec.continuous = true;
    rec.interimResults = true;

    rec.onstart = ()=>{ listening=true; setStatus(true); };
    rec.onend   = ()=>{ listening=false; setStatus(false); };
    rec.onerror = (e)=>{ appendLine(`[Erro]: ${e.error || 'desconhecido'}`); };

    rec.onresult = (ev)=>{
      let parcial = '';
      for(let i=ev.resultIndex;i<ev.results.length;i++){
        const r = ev.results[i];
        const t = (r[0] && r[0].transcript) ? r[0].transcript : '';
        if(r.isFinal){
          const phrase = t.trim();
          if(phrase){
            appendLine(phrase);
            runTriggers(phrase); // FINAL
          }
        } else {
          parcial = t;
        }
      }
      if(parcial){
        showPartial(parcial);
        if($("#partialOn").checked){
          if(partialTimer) clearTimeout(partialTimer);
          partialTimer = setTimeout(()=> runTriggers(parcial), COALESCE_MS); // PARCIAL
        }
      }
    };
    return rec;
  }

  function appendLine(text){
    if(!text) return;
    const cur = box.textContent;
    const sep = cur && !cur.endsWith('\n') ? '\n' : '';
    box.textContent = (cur||'') + sep + text + '\n';
    box.scrollTop = box.scrollHeight;
  }
  function showPartial(parcial){
    const lines = box.textContent.split('\n');
    if(lines[lines.length-1]?.trim()==='') lines.pop();
    const base = lines.join('\n');
    box.textContent = (base ? base+'\n' : '') + parcial;
    box.scrollTop = box.scrollHeight;
  }

  // ===== Controles =====
  $("#btnStart").onclick = ()=>{
    if(listening) return;
    if(!recognition) recognition = setupRec();
    if(recognition){ try{ recognition.start(); }catch{} }
  };
  $("#btnStop").onclick = ()=>{
    if(!listening || !recognition) return;
    try{ recognition.stop(); }catch{}
  };
  $("#btnClear").onclick = ()=>{ box.textContent = ""; };
</script>
</body>
</html>